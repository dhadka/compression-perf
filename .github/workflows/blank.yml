name: Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:
  
jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [macos-latest, windows-latest, ubuntu-latest]

    steps:
      - uses: actions/checkout@v2

      - name: Setup
        shell: bash
        run: |
          mkdir -p contents
          seq -w 1 10000 | xargs -n1 -I% sh -c 'dd if=/dev/urandom of=file.%.txt bs=1024 count=10'

      - name: Timings
        shell: bash
        run: |
          which tar > /dev/null && {
            echo "Tar Version"
            tar --version
          
            echo "Tar Create"
            time tar -cf contents_tar.tar contents/
            
            mkdir -p extracted_tar
            echo "Tar Extract"
            time tar -xf contents_tar.tar -C extracted_tar/
          } || echo "tar not found"
          
          which gtar > /dev/null && {
            echo "GTar Version"
            gtar --version
            
            echo "GTar Create"
            time gtar -cf contents_gtar.tar contents/
            
            mkdir -p extracted_gtar
            echo "GTar Extract"
            time gtar -xf contents_gtar.tar -C extracted_gtar/
            
            mkdir -p extracted_tar_with_gtar
            echo "GTar Extract Tar"
            time gtar -xf contents_tar.tar -C extracted_tar_with_gtar/
          } || echo "gtar not found"
